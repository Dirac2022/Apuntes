# Sistemas de Archivos Distribuidos


# Sistemas de Archivos Distribuidos


---

==Un sistema de archivos distribuido (DFS) permite almacenar y acceder archivos remotos como si fueran locales==, sin pérdida relevante de rendimiento y fiabilidad.
> [!tip] Responsable de operaciones como organización, almacenamiento, recuperación, nombrado, reparto y protección de archivos.

---

## Tipos de Almacenamiento
Un sistema de archivos distribuido es el único tipo de almacenamiento que provee reparto de archivos garantizando un nivel de consistencia aceptable

| **Tipo**                    | **Sharing** | **Persistence** | **Distributed cache/replicas** | **Consistency maintenance** | **Ejemplo**      |
| --------------------------- | ----------- | --------------- | ------------------------------ | --------------------------- | ---------------- |
| Main memory                 | ✕           | ✕               | ✕                              | 1 (una copia)               | RAM              |
| File system                 | ✕           | ✓               | ✕                              | 1                           | UNIX file system |
| Distributed file system     | ✓           | ✓               | ✓                              | ✓                           | Sun NFS          |
| Web                         | ✓           | ✓               | ✓                              | ✕                           | Web server       |
| Peer-to-peer storage system | ✓           | ✓               | ✓                              | 2 (consistencia débil)      | OceanStore       |

**Notas:**
- **Consistencia:**  
  - **1:** Una sola copia.  
  - **2:** Consistencia considerablemente más débil.  

---

• Un DFS es responsable de las operaciones sobre archivos:
	 • Organización
	 • Almacenamiento
	 • Recuperación
	 • Nombrado
	 • Reparto
	 • Protección
 • Un archivo contiene
	 • Datos: items (bytes) accesibles mediante lectura y escritura
	 • Atributos: registro indicando información sobre el archivo

----
## Atributos de Archivos
- **Registro de atributos gestionados por el sistema:**
	- Tamaño del archivo.
	- Marcas temporales (creación, lectura, escritura, atributos).
	- Contador de referencias.
	- Propietario.
	- Tipo de archivo.
	- Lista de control de acceso (ACL).

---

## Módulos de un DFS
| **Módulo**          | **Tarea**                                                                 |
|---------------------|---------------------------------------------------------------------------|
| Localización         | Resuelve y localiza nombres de archivos distribuidos.                    |
| Comunicación         | Establece comunicación entre cliente y servidor.                         |
| Directorio           | Relaciona nombres de archivos con ID.                                    |
| Archivos             | Relaciona ID de archivos con archivos concretos.                         |
| Control de acceso    | Verifica permisos para operaciones solicitadas.                          |
| Acceso a archivos    | Lee/escribe datos o atributos.                                           |
| Bloques              | Gestiona bloques de disco.                                               |
| Dispositivo          | Maneja E/S de disco y búferes.                                           |

---

## Interfaz y Operaciones

**Comparación DFS vs UNIX**

| **Operación**   | **DFS**                                      | **UNIX**                               |
| --------------- | -------------------------------------------- | -------------------------------------- |
| `abrir/cerrar`  | No son idempotentes.                         | Retornan puntero de lectura/escritura. |
| `leer/escribir` | Requiere especificar posición en el archivo. | Modifica automáticamente el puntero.   |
| `seguir`        | No soporta reposicionamiento de puntero.     | Permite reposicionar el puntero.       |

**Cualidades**

| **Cualidad**        | **DFS**                                                                 | **UNIX**                              |
|---------------------|-------------------------------------------------------------------------|---------------------------------------|
| Repetición          | Semántica "al menos uno"; operaciones idempotentes (excepto `crear`).  | Operaciones no idempotentes.          |
| Estado              | Sin estado; servidor reinicia sin necesidad de restaurar estado.       | Con estado; pérdida de puntero tras reinicio. |
| Control de acceso   | Identidad del usuario enviada en cada operación (sin estado).          | Basado en `uid` y permisos.           |

---

## Requisitos
1. **Transparencia:** Acceso uniforme independiente de ubicación o cambios.
	- El cliente debe ver y acceder a un DFS de manera uniforme independientemente de la ubicación de los archivos, de si estos cambian de ubicación o incrementa la carga o escala del servicio
2. **Heterogeneidad:** Compatibilidad con múltiples SO y hardware.
	- Respecto al SO y HW de cliente y servidor
3. **Concurrencia:** Manejo de accesos simultáneos.
4. **Eficiencia:** Rendimiento comparable a sistemas locales.
	- Rendimiento parecido al de un sistema de archivos local
5. **Seguridad:** Autenticación y listas de permisos.
	- Acceso a archivos por listas de permisos -> autenticación de clientes
6. **Tolerancia a fallos:** Replicación y consistencia aceptable.

---

## Arquitectura
### Componentes Clave
- **Servicio de archivos plano (Flat File Service):** Usa UFID (Unique File IDentifiers).
- **Servicio de directorios:** Mapea UFID a rutas textuales.
- **Módulo cliente:** Emula operaciones locales y gestiona cachés.
- **Interfaz RPC:** Comunicación cliente-servidor.

---

## NFS (Network File System)
### Características
- Protocolo independiente del SO, originalmente para UNIX.
- Comunicación mediante RPC sobre TCP/UDP.
- **Servidor NFS:**  
  - Operaciones similares a UNIX (`read`, `write`, `create`, `mkdir`, etc.).  
  - Estrategias de caché: `write-through` (escritura inmediata) o `commit` (escritura diferida).  

### Caché en Cliente
- Validación mediante marcas temporales (`Tc` y `Tm`).  
- Algoritmo:  
  - Si `T - Tc < t`: entrada válida.  
  - Si no, compara `Tm` del servidor con `Tm` local.  

### Seguridad
- **Kerberos:** Autenticación durante el montaje.  
- Identidad del usuario incluida en peticiones.  

---

## AFS (Andrew File System)
### Diferencias clave vs NFS
| **Aspecto**         | **NFS**                                  | **AFS**                                  |
|----------------------|------------------------------------------|------------------------------------------|
| Estado del servidor | Sin estado.                              | Mantiene callback promises.              |
| Consistencia        | Write-through o commit.                  | Chequeo en `open`/`close`.               |
| Escalabilidad       | Penalización con muchos usuarios.        | Optimizado para escalabilidad.           |

### Callbacks
- **Callback promise:** Garantía de notificación si otro cliente modifica un archivo.  
- Validación al reiniciar cliente.  

---

## Concurrencia Optimista (OCC)
### Fases
1. **Comienzo:** Registro de inicio de operación (ej: `open`).  
2. **Modificación:** Lectura/escritura tentativa.  
3. **Validación:** Chequeo de cambios externos.  
4. **Commit/Rollback:** Formalización o cancelación.  

### Ejemplo en HTTP
- Uso de `Etag` e `If-Match` para validar versiones de archivos.  

---

## Referencias
- Coulouris, G., Dollimore, J., Kindberg, T., & Blair, G. (2011). *Distributed Systems: Concepts and Design*.  
- Stern, H., Eisler, M., & Labiaga, R. (2001). *Managing NFS and NIS*.  
- Kung, H.T. (1981). *On Optimistic Methods for Concurrency Control*.  